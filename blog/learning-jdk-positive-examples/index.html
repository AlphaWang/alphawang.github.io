
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Learning JDK Source Code: Positive Examples - Alpha's Programming Notes</title>
  <meta name="author" content="Alpha Wang">

  
  <meta name="description" content="本文记录了一些Java源码中的良好编程习惯、运用的设计模式。">
  <meta name="keywords" content="Java, Design Patterns">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://alphawang.github.io/blog/learning-jdk-positive-examples">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Alpha's Programming Notes" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<script>
function addBlankTargetForLinks () {
  $('a[href^="http"]').each(function(){
      $(this).attr('target', '_blank');
  });
}

$(document).bind('DOMNodeInserted', function(event) {
  addBlankTargetForLinks();
});
</script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-54659411-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css" media="screen" />
<script type="text/javascript" src="/fancybox/jquery.fancybox.pack.js"></script>

<script language="Javascript" type="text/javascript">
$(document).ready(
  function() {
    (function($) {
      $(".fancybox[data-content-id]").each(function() {
        this.href = $(this).data('content-id');
      });
      $(".fancybox").fancybox({
        beforeLoad: function() {
          var el, 
              id = $(this.element).data('title-id');

          if (id) {
            el = $('#' + id);

            if (el.length) {
              this.title = el.html();
            }
          }
          if ($(this).data('content')) {
            this.content = $(this).data('content');
          }
        },
        helpers: {
          title: {
            type: 'inside'
          }
        }
      });
    })(jQuery);
  }
);
</script>

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">AlphaWang.com</a></h1>
  
    <h2>Alpha's Programming Notes | 一个程序员的日常</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:alphawang.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/tag-cloud/">Tags</a></li>
  <li><a href="/photography/">Photo</a></li>
  <li><a href="/about/">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Learning JDK Source Code: Positive Examples</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-12-02T16:21:09+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2014</span></span> <span class='time'>4:21 pm</span></time>

        
      </p>
    
  </header>


<div class="entry-content"><p>本文记录了一些Java源码中的良好编程习惯、运用的设计模式。</p>

<!--more-->


<h1>编程习惯</h1>

<h2>1. 用工厂方法替代构造函数</h2>

<h3>Boolean.valueOf()</h3>

<p>通过一个boolean简单类型，构造Boolean对象引用。</p>

<blockquote><p><strong>优点：无需每次被调用时都创建一个新对象。同时使得类可以严格控制在哪个时刻有哪些实例存在 </strong></p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/**
</span><span class='line'> * Returns a &lt;code&gt;Boolean&lt;/code&gt; with a value represented by the
</span><span class='line'> * specified string.  The &lt;code&gt;Boolean&lt;/code&gt; returned represents a
</span><span class='line'> * true value if the string argument is not &lt;code&gt;null&lt;/code&gt;
</span><span class='line'> * and is equal, ignoring case, to the string {@code "true"}.
</span><span class='line'> *
</span><span class='line'> * @param   s   a string.
</span><span class='line'> * @return  the &lt;code&gt;Boolean&lt;/code&gt; value represented by the string.
</span><span class='line'> */
</span><span class='line'>public static Boolean valueOf(String s) {
</span><span class='line'>    return toBoolean(s) ? TRUE : FALSE;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>静态工厂方法Boolean.valueOf(String)几乎总是比构造函数Boolean(String)更可取。构造函数每次被调用时都会创建一个新对象，而静态工厂方法则从来不要求这样做，实际上也不会这么做。</p>

<h3>BigInteger.probablePrime()</h3>

<p>构造方法<code>BigInteger(int, int, Random)</code>返回一个可能为素数的BigInteger，而用一个名为<code>BigInteger.probablePrime()</code>的静态工厂方法就更好。（JDK1.4最终增加了这个方法。）</p>

<blockquote><p><strong>优点：方法名对客户端更友好</strong></p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class BigInteger extends Number implements Comparable&lt;BigInteger&gt; { 
</span><span class='line'>   /**
</span><span class='line'>     * Returns a positive BigInteger that is probably prime, with the
</span><span class='line'>     * specified bitLength. The probability that a BigInteger returned
</span><span class='line'>     * by this method is composite does not exceed 2&lt;sup&gt;-100&lt;/sup&gt;.
</span><span class='line'>     *
</span><span class='line'>     */
</span><span class='line'>    public static BigInteger probablePrime(int bitLength, Random rnd) {
</span><span class='line'>    if (bitLength &lt; 2)
</span><span class='line'>        throw new ArithmeticException("bitLength &lt; 2");
</span><span class='line'>        // The cutoff of 95 was chosen empirically for best performance
</span><span class='line'>        return (bitLength &lt; SMALL_PRIME_THRESHOLD ?
</span><span class='line'>                smallPrime(bitLength, DEFAULT_PRIME_CERTAINTY, rnd) :
</span><span class='line'>                largePrime(bitLength, DEFAULT_PRIME_CERTAINTY, rnd));
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<h3>EnumSet</h3>

<p>JDK1.5引入的<code>java.util.EnumSet</code>类没有public构造函数，只有静态工厂方法。根据底层枚举类型的大小，这些工厂方法可以返回两种实现：</p>

<ul>
<li>如果拥有64个或更少的元素（大多数枚举类型都是这样），静态工厂方法返回一个<code>RegularEnumSet</code>实例，用单个<code>long</code>来支持；</li>
<li>如果枚举类型拥有65个或更多的元素，静态工厂方法则返回<code>JumboEnumSet</code>实例，用<code>long数组</code>来支持。</li>
</ul>


<blockquote><p><strong>优点：静态工厂方法能返回任意子类型的对象。可以根据参数的不同，而返回不同的类型。</strong></p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public abstract class EnumSet&lt;E extends Enum&lt;E&gt;&gt; extends AbstractSet&lt;E&gt;
</span><span class='line'>    implements Cloneable, java.io.Serializable
</span><span class='line'>{
</span><span class='line'>    /**
</span><span class='line'>     * Creates an empty enum set with the specified element type.
</span><span class='line'>     *
</span><span class='line'>     * @param elementType the class object of the element type for this enum
</span><span class='line'>     *     set
</span><span class='line'>     * @throws NullPointerException if &lt;tt&gt;elementType&lt;/tt&gt; is null
</span><span class='line'>     */
</span><span class='line'>    public static &lt;E extends Enum&lt;E&gt;&gt; EnumSet&lt;E&gt; noneOf(Class&lt;E&gt; elementType) {
</span><span class='line'>        Enum[] universe = getUniverse(elementType);
</span><span class='line'>        if (universe == null)
</span><span class='line'>            throw new ClassCastException(elementType + " not an enum");
</span><span class='line'>        if (universe.length &lt;= 64)
</span><span class='line'>            return new RegularEnumSet&lt;E&gt;(elementType, universe);
</span><span class='line'>        else
</span><span class='line'>            return new JumboEnumSet&lt;E&gt;(elementType, universe);
</span><span class='line'>    }
</span><span class='line'>}
</span><span class='line'> 
</span><span class='line'>class RegularEnumSet&lt;E extends Enum&lt;E&gt;&gt; extends EnumSet&lt;E&gt; {
</span><span class='line'>}
</span><span class='line'> 
</span><span class='line'>class JumboEnumSet&lt;E extends Enum&lt;E&gt;&gt; extends EnumSet&lt;E&gt; {
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>Collections.unmodifiableMap(Map)</h3>

<p>Java集合框架中有32个集合接口的便利实现，提供不可修改的集合、同步集合等等。几乎所有的实现都通过一个不可实例化类（<code>java.util.Collections</code>）中的静态工厂方法导出，返回对象的类都是非public的。</p>

<blockquote><p><strong>优点：静态工厂方法能返回任意子类型的对象。可以返回一个对象而无需使相应的类public。用这种方式隐藏实现类能够产生一个非常紧凑的API</strong></p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class Collections {
</span><span class='line'>    /**
</span><span class='line'>     * Returns an unmodifiable view of the specified map.  This method
</span><span class='line'>     * allows modules to provide users with "read-only" access to internal
</span><span class='line'>     * maps.  Query operations on the returned map "read through"
</span><span class='line'>     * to the specified map, and attempts to modify the returned
</span><span class='line'>     * map, whether direct or via its collection views, result in an
</span><span class='line'>     * &lt;tt&gt;UnsupportedOperationException&lt;/tt&gt;.&lt;p&gt;
</span><span class='line'>     *
</span><span class='line'>     */
</span><span class='line'>    public static &lt;K,V&gt; Map&lt;K,V&gt; unmodifiableMap(Map&lt;? extends K, ? extends V&gt; m) {
</span><span class='line'>        return new UnmodifiableMap&lt;K,V&gt;(m);
</span><span class='line'>    }
</span><span class='line'> 
</span><span class='line'>    private static class UnmodifiableMap&lt;K,V&gt; implements Map&lt;K,V&gt;, Serializable {
</span><span class='line'>      }</span></code></pre></td></tr></table></div></figure>


<h2>2. 私有化构造函数，实现Singleton</h2>

<h3>Arrays</h3>

<p>这种工具类设计出来并不是为了实例化它。然而，如果不显式地编写构造函数，编译器则会提供一个公共的无参数的默认构造方法。
所以将构造函数私有化：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class Arrays {
</span><span class='line'>    // Suppresses default constructor, ensuring non-instantiability.
</span><span class='line'>    private Arrays() {
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<p>当然，还可以在这个私有构造器内部加上 <code>throw new AssertionError()</code>，可以确保该方法不会再类内部被意外调用。</p>

<p><strong>这种习惯用法的副作用是类不能被子类化了</strong>。子类的所有构造函数必须首先隐式或显式地调用父类构造函数，而在这种用法下，子类就没有可访问的父类构造函数可调用了。</p>

<h3>TimeUnit</h3>

<p><code>java.util.concurrent.TimeUnit</code>使用枚举来实现Singleton：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public enum TimeUnit {
</span><span class='line'>    MILLISECONDS {
</span><span class='line'>        public long toNanos(long d)   { return x(d, C2/C0, MAX/(C2/C0)); }
</span><span class='line'>        public long toMicros(long d)  { return x(d, C2/C1, MAX/(C2/C1)); }
</span><span class='line'>        public long toMillis(long d)  { return d; }
</span><span class='line'>        public long toSeconds(long d) { return d/(C3/C2); }
</span><span class='line'>        public long toMinutes(long d) { return d/(C4/C2); }
</span><span class='line'>        public long toHours(long d)   { return d/(C5/C2); }
</span><span class='line'>        public long toDays(long d)    { return d/(C6/C2); }
</span><span class='line'>        public long convert(long d, TimeUnit u) { return u.toMillis(d); }
</span><span class='line'>        int excessNanos(long d, long m) { return 0; }
</span><span class='line'>    },
</span><span class='line'>    SECONDS {
</span><span class='line'>       .....
</span><span class='line'>    },
</span><span class='line'>    MINUTES {
</span><span class='line'>       .....
</span><span class='line'>    },
</span><span class='line'>    HOURS {
</span><span class='line'>       ......
</span><span class='line'>    },
</span><span class='line'>    DAYS {
</span><span class='line'>       .....
</span><span class='line'>    };
</span><span class='line'>
</span><span class='line'>    // TimeUnit.sleep()用来替代Thread.sleep()
</span><span class='line'>    public void sleep(long timeout) throws InterruptedException {
</span><span class='line'>        if (timeout &gt; 0) {
</span><span class='line'>            long ms = toMillis(timeout);
</span><span class='line'>            int ns = excessNanos(timeout, ms);
</span><span class='line'>            Thread.sleep(ms, ns);
</span><span class='line'>        }
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<h2>3. 避免创建不必要的对象</h2>

<h3>Map.keySet()</h3>

<p>Map接口的keySet()方法返回Map对象的一个Set视图，包含该Map的所有key。
看起来好像每次调用keySet()都需要创建一个新的Set实例。而实际上，虽然返回的Set通常是可变的，但返回的对象在功能上是等同的：<strong>如果其中一个返回对象改变，其他对象也会改变，因为他们的底层都是同一个Map实例</strong>。虽然创建多个KeySet视图对象并没有害处，但也没有必要。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public abstract class AbstractMap&lt;K,V&gt; implements Map&lt;K,V&gt; {
</span><span class='line'> 
</span><span class='line'>    /**
</span><span class='line'>     * Each of these fields are initialized to contain an instance of the
</span><span class='line'>     * appropriate view the first time this view is requested.  The views are
</span><span class='line'>     * stateless, so there's no reason to create more than one of each.
</span><span class='line'>     */
</span><span class='line'>   transient volatile Set&lt;K&gt; keySet = null;
</span><span class='line'>   public Set&lt;K&gt; keySet() {
</span><span class='line'>    if (keySet == null) {
</span><span class='line'>        keySet = new AbstractSet&lt;K&gt;() {
</span><span class='line'>        .....
</span><span class='line'>        };
</span><span class='line'>    }
</span><span class='line'>    return keySet;
</span><span class='line'>    }    
</span><span class='line'>}   </span></code></pre></td></tr></table></div></figure>


<p>注意在构造keySet之前 对齐进行了null检查；只有当它是null时才会初始化。</p>

<h2>4. 消除无用的对象引用</h2>

<h3>LinkedHashMap.removeEldestEntry()</h3>

<p>缓存实体的生命周期不容易确定，随着时间推移，实体的价值越来越低。在这种情况下，缓存应该不定期地清理无用的实体。可以通过一个后台线程来清理（可能是<code>Timer</code>或<code>ScheduledThreadPoolExecutor</code>），也可以在给缓存添加新实体时进行清理。</p>

<p>LikedHashMap可利用其removeEldestEntry，删除较老的实体：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class LinkedHashMap&lt;K,V&gt;
</span><span class='line'>    extends HashMap&lt;K,V&gt;
</span><span class='line'>    implements Map&lt;K,V&gt;
</span><span class='line'>{
</span><span class='line'>   /**
</span><span class='line'>     * It causes newly allocated entry to get inserted at the end of the linked list and
</span><span class='line'>     * removes the eldest entry if appropriate.
</span><span class='line'>     */
</span><span class='line'>    void addEntry(int hash, K key, V value, int bucketIndex) {
</span><span class='line'>        createEntry(hash, key, value, bucketIndex);
</span><span class='line'>        // Remove eldest entry if instructed, else grow capacity if appropriate
</span><span class='line'>        Entry&lt;K,V&gt; eldest = header.after;
</span><span class='line'>        if (removeEldestEntry(eldest)) {
</span><span class='line'>            removeEntryForKey(eldest.key);
</span><span class='line'>        } else {
</span><span class='line'>            if (size &gt;= threshold)
</span><span class='line'>                resize(2 * table.length);
</span><span class='line'>        }
</span><span class='line'>    }
</span><span class='line'>    /**
</span><span class='line'>     * Returns &lt;tt&gt;true&lt;/tt&gt; if this map should remove its eldest entry.
</span><span class='line'>     * This method is invoked by &lt;tt&gt;put&lt;/tt&gt; and &lt;tt&gt;putAll&lt;/tt&gt; after
</span><span class='line'>     * inserting a new entry into the map.  
</span><span class='line'>     *
</span><span class='line'>     * Sample use: 
</span><span class='line'>     * &lt;pre&gt;
</span><span class='line'>     *     private static final int MAX_ENTRIES = 100;
</span><span class='line'>     *
</span><span class='line'>     *     protected boolean removeEldestEntry(Map.Entry eldest) {
</span><span class='line'>     *        return size() &gt; MAX_ENTRIES;
</span><span class='line'>     *     }
</span><span class='line'>     * &lt;/pre&gt;
</span><span class='line'>     *
</span><span class='line'>     */
</span><span class='line'>    protected boolean removeEldestEntry(Map.Entry&lt;K,V&gt; eldest) {
</span><span class='line'>        return false;
</span><span class='line'>    }
</span></code></pre></td></tr></table></div></figure>


<p>——可以继承LinkedHashMap，覆盖其removeEldestEntry方法。</p>

<blockquote><p>注：如果想要缓存中的对象只要不被引用，就自动清理；则可以用WeakHashMap</p></blockquote>

<h2>5. 如果指定了toString返回值的格式，则应该提供一个对应的静态工厂方法或构造函数</h2>

<h3>BigInteger.toString()</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/**
</span><span class='line'> * Returns the String representation of this BigInteger in the
</span><span class='line'> * given radix.  
</span><span class='line'> *
</span><span class='line'> */
</span><span class='line'>public String toString(int radix) {
</span><span class='line'> 
</span><span class='line'>/**
</span><span class='line'> * Returns the decimal String representation of this BigInteger.
</span><span class='line'> */
</span><span class='line'>public String toString() {
</span><span class='line'>    return toString(10);
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>对应的构造函数如下。这样程序员能容易地在对象及其字符串表示之间来回转换</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/**
</span><span class='line'> * Translates the decimal String representation of a BigInteger into a
</span><span class='line'> * BigInteger.  
</span><span class='line'> */
</span><span class='line'>public BigInteger(String val) {
</span><span class='line'>    this(val, 10);
</span><span class='line'>}
</span><span class='line'>/**
</span><span class='line'> * Translates the String representation of a BigInteger in the specified
</span><span class='line'> * radix into a BigInteger.  
</span><span class='line'> */
</span><span class='line'>public BigInteger(String val, int radix) { </span></code></pre></td></tr></table></div></figure>


<h2>6. 不可变对象</h2>

<h3>共享不可变对象内部信息:  BigInteger.negate()：</h3>

<blockquote><p>我们可以自由地共享不可变对象，还可以共享他们的内部信息。</p></blockquote>

<p>【例】BigInteger类内部使用了一个符号数值表示法（sign-magnitude representation），符号用一个int表示，数值则用一个int数组表示。<code>negate()</code>方法会创建一个数值相同但符号相反的新<code>BigInteger</code>，该方法不需要拷贝数组，新创建的BigInteger只需要指向源对象中的数组即可。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/**
</span><span class='line'> * Returns a BigInteger whose value is {@code (-this)}.
</span><span class='line'> *
</span><span class='line'> * @return {@code -this}
</span><span class='line'> */
</span><span class='line'>public BigInteger negate() {
</span><span class='line'>      return new BigInteger(this.mag, -this.signum);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h3>鼓励重用现有不可变实例: BigInteger.ZERO</h3>

<p><strong>不可变对象生来就是线程安全的，他们不需要同步</strong>。当多个线程并发访问不可变对象时，他们不会遭到破坏。这无疑是实现线程安全的最容易的方法。实际上，不会有线程能观察到其他线程对不可变对象的影响。所以不可变对象可以被自由地共享。</p>

<p>不可变类应当利用这种优势，鼓励客户端尽可能重用现有实例。一个简单的方法是为常用的值提供public static final的常量。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public static final BigInteger ZERO = new BigInteger(new int[0], 0);
</span><span class='line'>public static final BigInteger ONE = valueOf(1);
</span><span class='line'>public static final BigInteger TEN = valueOf(10);</span></code></pre></td></tr></table></div></figure>


<h3>为不可变类提供companion class:  String vs. StringBuilder</h3>

<p>不可变类的一个缺点是，对于每个不同的值都需要一个单独的对象。那么在执行复杂的多步操作时，每一步都会创建一个新的对象。</p>

<p>通过提供<code>companion class</code>可以解决这个问题。例如当需要对<code>String</code>执行复杂操作时，建议使用<code>StringBuilder</code>。</p>

<h3>不可变类中可以有nonfinal域，用于存储缓存: String.hashCode()：</h3>

<p>不可变类所有域必须是final的。实际上这些规则比较强硬，为了提供性能可以有所放松。实际上应该是没有方法能够对类的状态产生外部可见的改变（no method may produce an externally visible change in the object’s state）。</p>

<p>然而，一些不可变类拥有一个或多个nonfinal域，用于缓存昂贵计算的结果。这个技巧可以很好地工作，因为对象是不可变的，保证了相同的计算总是返回同样的结果。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/** Cache the hash code for the string */
</span><span class='line'>private int hash; // Default to 0
</span><span class='line'> 
</span><span class='line'>public int hashCode() {
</span><span class='line'>  int h = hash;
</span><span class='line'>  int len = count;
</span><span class='line'>  if (h == 0 && len &gt; 0) {
</span><span class='line'>    int off = offset;
</span><span class='line'>    char val[] = value;
</span><span class='line'>        for (int i = 0; i &lt; len; i++) {
</span><span class='line'>            h = 31*h + val[off++];
</span><span class='line'>        }
</span><span class='line'>        hash = h;
</span><span class='line'>  }
</span><span class='line'>  return h;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h1>设计模式</h1>

<h2>1. Template Method</h2>

<h3>Arrays.sort()</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// Arrays  
</span><span class='line'>   public static void sort(Object[] a) {  
</span><span class='line'>        ...  
</span><span class='line'>        ComparableTimSort.sort(a);  
</span><span class='line'>    }  
</span><span class='line'>  
</span><span class='line'>// ComparableTimSort  
</span><span class='line'>   static void sort(Object[] a, int lo, int hi) {  
</span><span class='line'>        ...  
</span><span class='line'>        binarySort(a, lo, hi, lo + initRunLen);  
</span><span class='line'>             
</span><span class='line'>   } </span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//算法框架  
</span><span class='line'>private static void binarySort(Object[] a, int lo, int hi, int start) {  
</span><span class='line'>    assert lo &lt;= start && start &lt;= hi;  
</span><span class='line'>    if (start == lo)  
</span><span class='line'>        start++;  
</span><span class='line'>    for ( ; start &lt; hi; start++) {  
</span><span class='line'>        @SuppressWarnings("unchecked")  
</span><span class='line'>        Comparable&lt;Object&gt; pivot = (Comparable) a[start];  
</span><span class='line'>  
</span><span class='line'>        // Set left (and right) to the index where a[start] (pivot) belongs  
</span><span class='line'>        ....  
</span><span class='line'>        while (left &lt; right) {  
</span><span class='line'>            int mid = (left + right) &gt;&gt;&gt; 1;  
</span><span class='line'>            if (pivot.compareTo(a[mid]) &lt; 0) //compareTo这个算法步骤，是由各个Comparable的子类定义的  
</span><span class='line'>                right = mid;  
</span><span class='line'>            else  
</span><span class='line'>                left = mid + 1;  
</span><span class='line'>        }  
</span><span class='line'>        ....  
</span><span class='line'>    }  
</span><span class='line'>} </span></code></pre></td></tr></table></div></figure>


<p>Q：这个算法框架并不是设计在父类中，而是在一个工具类中</p>

<p>A：是的，与教科书上模板方法的定义有差异；因为sort要适用于所有数组，所以提供了一个Arrays工具类。但仍然是模板方法模式</p>

<h3>InputStream.read()</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> //算法框架  
</span><span class='line'> public int read(byte b[], int off, int len) throws IOException {  
</span><span class='line'>        ...  
</span><span class='line'>  
</span><span class='line'>        int c = read();  
</span><span class='line'>          
</span><span class='line'>        ...  
</span><span class='line'>}  
</span><span class='line'>  
</span><span class='line'>//算法步骤由子类实现  
</span><span class='line'>public abstract int read() throws IOException;  </span></code></pre></td></tr></table></div></figure>


<h3>JFrame.paint()</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// JFrame  
</span><span class='line'>    public void update(Graphics g) {  
</span><span class='line'>        paint(g);  
</span><span class='line'>    }  
</span><span class='line'>
</span><span class='line'>public class MyFrame extends JFrame {  
</span><span class='line'>    public MyFrame(){  
</span><span class='line'>        super();  
</span><span class='line'>        this.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);  
</span><span class='line'>        this.setSize(300,300);  
</span><span class='line'>        this.setVisible(true);  
</span><span class='line'>    }  
</span><span class='line'>      
</span><span class='line'>    @Override  
</span><span class='line'>    public void paint(Graphics g){ //重定义算法步骤  
</span><span class='line'>        super.paint(g);  
</span><span class='line'>        g.drawString("I rule !", 100, 100);  
</span><span class='line'>    }  
</span><span class='line'>      
</span><span class='line'>    public static void main(String[] args){  
</span><span class='line'>        MyFrame frame = new MyFrame();  
</span><span class='line'>    }  
</span><span class='line'>  
</span><span class='line'>} </span></code></pre></td></tr></table></div></figure>


<h3>Applet.init()/start()/stop()/destroy()/paint()</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// Applet  
</span><span class='line'>    public void init() { //什么也不做的hook  
</span><span class='line'>    }  
</span><span class='line'>
</span><span class='line'>// Beans  
</span><span class='line'>   public static Object instantiate(ClassLoader cls, String beanName,   
</span><span class='line'>                    BeanContext beanContext, AppletInitializer initializer)  
</span><span class='line'>                        throws IOException, ClassNotFoundException {  
</span><span class='line'>  
</span><span class='line'>          
</span><span class='line'>  
</span><span class='line'>                // If it was deserialized then it was already init-ed.  
</span><span class='line'>                // Otherwise we need to initialize it.  
</span><span class='line'>  
</span><span class='line'>                if (!serialized) {  
</span><span class='line'>                    // We need to set a reasonable initial size, as many  
</span><span class='line'>                    // applets are unhappy if they are started without  
</span><span class='line'>                    // having been explicitly sized.  
</span><span class='line'>                    applet.setSize(100,100);  
</span><span class='line'>                    applet.init(); //调用hook  
</span><span class='line'>                }  
</span><span class='line'>  
</span><span class='line'>                  
</span><span class='line'>        }  
</span><span class='line'>  
</span><span class='line'>        return result;  
</span><span class='line'>    }  </span></code></pre></td></tr></table></div></figure>


<p>Applet中的init()/start()/stop()/destroy()/paint()这些方法，都是hook。</p>

<h2>2. Iterator</h2>

<h3>Collection.iterator()</h3>

<h2>3. Adapter</h2>

<h3>RunnableAdapter</h3>

<p>完整类名：<code>java.util.concurrent.Executors.RunnableAdapter&lt;T&gt;</code></p>

<p>我们知道<code>FutureTask</code>接受一个<code>Callable</code>参数，那如果我们现有的是<code>Runnable</code>该怎么办呢？
<code>FutureTask</code>本身提供了适配：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/**
</span><span class='line'> * Creates a &lt;tt&gt;FutureTask&lt;/tt&gt; that will upon running, execute the given &lt;tt&gt;Callable&lt;/tt&gt;.
</span><span class='line'> */
</span><span class='line'>public FutureTask(Callable&lt;V&gt; callable) {
</span><span class='line'>    sync = new Sync(callable);
</span><span class='line'>}
</span><span class='line'> 
</span><span class='line'>/**
</span><span class='line'> * Creates a &lt;tt&gt;FutureTask&lt;/tt&gt; that will upon running, execute the given &lt;tt&gt;Runnable&lt;/tt&gt;
</span><span class='line'> */
</span><span class='line'>public FutureTask(Runnable runnable, V result) {
</span><span class='line'>    sync = new Sync(Executors.callable(runnable, result));
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p> Executors.callable()返回Adapter对象：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public static &lt;T&gt; Callable&lt;T&gt; callable(Runnable task, T result) {
</span><span class='line'>    return new RunnableAdapter&lt;T&gt;(task, result);
</span><span class='line'>}
</span><span class='line'> 
</span><span class='line'>/** --Adapter!--
</span><span class='line'> * A callable that runs given task and returns given result
</span><span class='line'> */
</span><span class='line'>static final class RunnableAdapter&lt;T&gt; implements Callable&lt;T&gt; {  //Target
</span><span class='line'>    final Runnable task; //Adaptee
</span><span class='line'>    final T result;
</span><span class='line'>    RunnableAdapter(Runnable  task, T result) {
</span><span class='line'>        this.task = task;
</span><span class='line'>        this.result = result;
</span><span class='line'>    }
</span><span class='line'>    public T call() {
</span><span class='line'>        task.run();
</span><span class='line'>        return result;
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>AbstractExecutorService.submit()也用到了这个Adapter：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>   public &lt;T&gt; Future&lt;T&gt; submit(Runnable task, T result) {
</span><span class='line'>        if (task == null) throw new NullPointerException();
</span><span class='line'>        RunnableFuture&lt;T&gt; ftask = newTaskFor(task, result);
</span><span class='line'>        execute(ftask);
</span><span class='line'>        return ftask;
</span><span class='line'>    }
</span><span class='line'>    protected &lt;T&gt; RunnableFuture&lt;T&gt; newTaskFor(Runnable runnable, T value) {
</span><span class='line'>        return new FutureTask&lt;T&gt;(runnable, value);
</span><span class='line'>    }</span></code></pre></td></tr></table></div></figure>


<p>未完待续。。。</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Alpha Wang</span></span>

      




<time class='entry-date' datetime='2014-12-02T16:21:09+08:00'><span class='date'><span class='date-month'>Dec</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2014</span></span> <span class='time'>4:21 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/java/'>java</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
  
  	
<!--Baidu Share-->
<div class="bdsharebuttonbox">
<a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
<a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
<a href="#" class="bds_linkedin" data-cmd="linkedin" title="分享到linkedin"></a>
<a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
<a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
<a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a>
<a href="#" class="bds_youdao" data-cmd="youdao" title="分享到有道云笔记"></a>
<a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
<a href="#" class="bds_more" data-cmd="more"></a>
</div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"",
"bdStyle":"2", //1
"bdSize":"24"},
"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>


<!--Google Adsense-->
<p class="meta" style="text-align:center">
	<!-- 728*90 -->
	<!--
	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<ins class="adsbygoogle"
	     style="display:inline-block;width:728px;height:90px"
	     data-ad-client="ca-pub-6393503301700908"
	     data-ad-slot="2039334876"></ins>
	<script>
	(adsbygoogle = window.adsbygoogle || []).push({});
	</script>
	-->
	
	<!-- 789*90 -->
	<!--
	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<ins class="adsbygoogle"
	     style="display:inline-block;width:789px;height:90px"
	     data-ad-client="ca-pub-6393503301700908"
	     data-ad-slot="7806666870"></ins>
	<script>
	(adsbygoogle = window.adsbygoogle || []).push({});
	</script>
	-->
</p>

<!-- UY BEGIN -->
<!--<div id="uyan_frame"></div>-->
<!--<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1965224"></script>-->
<!-- UY END -->
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/learning-jdk-negative-examples/" title="Previous Post: Learning JDK Source Code: Negative Examples">&laquo; Learning JDK Source Code: Negative Examples</a>
      
      
        <a class="basic-alignment right" href="/blog/what-is-string-intern/" title="Next Post: What's String.intern()">What's String.intern() &raquo;</a>
      
    </p>

    <!-- Gitalk 评论 start  -->

    <!-- Link Gitalk 的支持文件  -->
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script>
    <div id="gitalk-container"></div>     <script type="text/javascript">
      var gitalk = new Gitalk({

          // gitalk的主要参数
          clientID: 'd4cba670eb5bd4b63a2e',
          clientSecret: '5a3498bf127676c9aaacf738a8b26d976154fad3',
          repo: 'alphawang.github.io',
          owner: 'AlphaWang',
          admin: ['AlphaWang'],
          id: location.pathname,

      });
      gitalk.render('gitalk-container');
    </script>
    <!-- Gitalk end -->
  </footer>
</article>

  

</div>

<aside class="sidebar">
  
    <section>
 <h1>Categories</h1>
 <ul id="categories">
	 <li class='category'><a href='/blog/categories/design-patterns/'>design patterns (7)</a></li>
<li class='category'><a href='/blog/categories/distributed-system/'>distributed system (4)</a></li>
<li class='category'><a href='/blog/categories/java/'>java (12)</a></li>
<li class='category'><a href='/blog/categories/mac/'>mac (2)</a></li>
<li class='category'><a href='/blog/categories/messaging/'>messaging (2)</a></li>
<li class='category'><a href='/blog/categories/nosql/'>nosql (1)</a></li>
<li class='category'><a href='/blog/categories/site/'>site (1)</a></li>
<li class='category'><a href='/blog/categories/solr/'>solr (2)</a></li>
<li class='category'><a href='/blog/categories/translation/'>translation (3)</a></li>
<li class='category'><a href='/blog/categories/web/'>web (1)</a></li>

 </ul>
</section>
<section>
<h1>Tags</h1>
<ul class="tag-cloud">
	<a style="font-size: 90%" href="/blog/tags/css/">CSS</a>
<a style="font-size: 119%" href="/blog/tags/collection/">Collection</a>
<a style="font-size: 171%" href="/blog/tags/design-pattern/">Design Pattern</a>
<a style="font-size: 119%" href="/blog/tags/guava/">Guava</a>
<a style="font-size: 171%" href="/blog/tags/jdk/">JDK</a>
<a style="font-size: 90%" href="/blog/tags/jmm/">JMM</a>
<a style="font-size: 90%" href="/blog/tags/jvm/">JVM</a>
<a style="font-size: 210%" href="/blog/tags/java/">Java</a>
<a style="font-size: 90%" href="/blog/tags/kafka/">Kafka</a>
<a style="font-size: 119%" href="/blog/tags/mac/">Mac</a>
<a style="font-size: 90%" href="/blog/tags/photography/">Photography</a>
<a style="font-size: 119%" href="/blog/tags/pulsar/">Pulsar</a>
<a style="font-size: 90%" href="/blog/tags/resilience/">Resilience</a>
<a style="font-size: 164%" href="/blog/tags/solid/">SOLID</a>
<a style="font-size: 119%" href="/blog/tags/site/">Site</a>
<a style="font-size: 119%" href="/blog/tags/solr/">Solr</a>
<a style="font-size: 164%" href="/blog/tags/source-code/">Source Code</a>
<a style="font-size: 90%" href="/blog/tags/spring-mvc/">Spring MVC</a>
<a style="font-size: 119%" href="/blog/tags/spring-solr/">Spring Solr</a>
<a style="font-size: 136%" href="/blog/tags/string/">String</a>
<a style="font-size: 119%" href="/blog/tags/tool/">Tool</a>
<a style="font-size: 119%" href="/blog/tags/web/">Web</a>
<a style="font-size: 90%" href="/blog/tags/ajax/">ajax</a>
<a style="font-size: 90%" href="/blog/tags/clean-code/">clean code</a>
<a style="font-size: 90%" href="/blog/tags/cluster/">cluster</a>
<a style="font-size: 90%" href="/blog/tags/dapper/">dapper</a>
<a style="font-size: 148%" href="/blog/tags/distributed-system/">distributed system</a>
<a style="font-size: 119%" href="/blog/tags/messaging/">messaging</a>
<a style="font-size: 90%" href="/blog/tags/nosql/">nosql</a>
<a style="font-size: 90%" href="/blog/tags/redis/">redis</a>
<a style="font-size: 90%" href="/blog/tags/sentinel/">sentinel</a>
<a style="font-size: 90%" href="/blog/tags/tracing/">tracing</a>
<a style="font-size: 119%" href="/blog/tags/translation/">translation</a>
<a style="font-size: 90%" href="/blog/tags/dai-ma-zheng-ji-zhi-dao/">代码整洁之道</a>
<a style="font-size: 90%" href="/blog/tags/xue-xi-zong-jie/">学习总结</a>

</ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/kafka-versus-pulsar/">Apache Pulsar 与 Apache Kafka 之对比分析</a>
      </li>
    
      <li class="post">
        <a href="/blog/pulsar-load-balancing/">详解 Pulsar Broker 负载均衡</a>
      </li>
    
      <li class="post">
        <a href="/blog/how-to-verify-if-resilience4j-circuit-breaker-works/">How to Verify if Resilience4j Circuit Breaker Works</a>
      </li>
    
      <li class="post">
        <a href="/blog/clean-code/">Clean Code Summary</a>
      </li>
    
      <li class="post">
        <a href="/blog/redis-mind-map/">Redis Mind Map</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Links</h1>
  <ul id="recent_posts">
    <li class="post"><a href="https://alpha.blog.csdn.net/">Alpha's CSDN Blog</a></li>
    <li class="post"><a href="https://github.com/AlphaWang/">Alpha's Github</a></li>
  </ul>
</section><section>
  <h1>Visitors Map</h1>
  <div class="earth">
    <script type="text/javascript" src="//ri.revolvermaps.com/0/0/8.js?i=awaok66hddi&amp;m=0&amp;c=ff0000&amp;cr1=ffffff&amp;f=arial&amp;l=49" async="async"></script>
  </div>
</section>
  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2022 - Alpha Wang -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
  <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253224710'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s5.cnzz.com/z_stat.php%3Fid%3D1253224710%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</p>

</footer>
  











</body>
</html>
